<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Globe View</title>
  <script src="https://unpkg.com/globe.gl"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
    }

    #globeContainer {
      width: 100%;
      height: 100%;
      position: relative;
    }

    .city-label {
      position: absolute;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(4px);
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-transform: uppercase;
      transform: translate(-50%, -50%);
      pointer-events: none;
      white-space: nowrap;
      opacity: 1;
      transition: opacity 0.3s ease;
    }
  </style>
</head>
<body>
  <div id="globeContainer"></div>

  <script>
    const cities = [
      { name: "SÃƒO PAULO", lat: -23.5505, lng: -46.6333 },
      { name: "LIMA", lat: -12.0464, lng: -77.0428 },
      { name: "SANTIAGO", lat: -33.4489, lng: -70.6693 }
    ];

    const arcs = [
      { startLat: -23.5505, startLng: -46.6333, endLat: -12.0464, endLng: -77.0428 },
      { startLat: -12.0464, startLng: -77.0428, endLat: -33.4489, endLng: -70.6693 },
      { startLat: -33.4489, startLng: -70.6693, endLat: -23.5505, endLng: -46.6333 }
    ];

    const globe = Globe()
      .globeImageUrl(null)
      .backgroundImageUrl(null)
      .showAtmosphere(true)
      .atmosphereColor('rgba(255, 50, 50, 0.1)')
      .atmosphereAltitude(0.25)
      (document.getElementById('globeContainer'));

    // Replace globe mesh with low-poly wireframe
    function replaceGlobeGeometry() {
      const mesh = globe.scene().children.find(obj =>
        obj.type === 'Mesh' &&
        obj.geometry &&
        obj.geometry.type === 'SphereGeometry'
      );
      if (mesh) {
        mesh.geometry.dispose();
        mesh.geometry = new THREE.SphereGeometry(1, 10, 10); // Low-poly
        mesh.material.dispose();
        mesh.material = new THREE.MeshBasicMaterial({
          color: 0xffffff,
          wireframe: true
        });
      } else {
        console.warn("Globe mesh not found.");
      }
    }
    setTimeout(replaceGlobeGeometry, 100);

    // Arcs: Hot pink & animated
    globe.arcsData(arcs)
      .arcColor(() => 'hotpink')
      .arcDashLength(0.4)
      .arcDashGap(1)
      .arcDashAnimateTime(2000)
      .arcStroke(1.5)
      .arcCurveResolution(32);

    // Points (city dots)
    globe.pointsData(cities)
      .pointColor(() => 'white')
      .pointAltitude(0.1)
      .pointRadius(0.2)
      .pointResolution(8);

    // Always-visible city labels
    globe.htmlElementsData(cities)
      .htmlLat(d => d.lat)
      .htmlLng(d => d.lng)
      .htmlElement(d => {
        const el = document.createElement('div');
        el.className = 'city-label';
        el.textContent = d.name;
        return el;
      });

    // Optional: Dim labels when zoomed out
    globe.controls().addEventListener('change', () => {
      const camZ = globe.camera().position.length();
      document.querySelectorAll('.city-label').forEach(el => {
        el.style.opacity = camZ < 4 ? '1' : '0.3';
      });
    });

    // Camera setup
    setTimeout(() => {
      globe.pointOfView({ lat: -25, lng: -60, altitude: 2 }, 1500);
    }, 500);

    // Auto-rotation
    globe.controls().autoRotate = true;
    globe.controls().autoRotateSpeed = 0.4;
    globe.controls().dampingFactor = 0.1;

    // Handle resize
    window.addEventListener('resize', () => {
      globe.width(window.innerWidth);
      globe.height(window.innerHeight);
      globe.camera().aspect = window.innerWidth / window.innerHeight;
      globe.camera().updateProjectionMatrix();
    });
  </script>
</body>
</html>
